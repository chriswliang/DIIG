---
title: "Hotels"
author: "Christina Liang"
output: pdf_document
---
```{r packages, message = FALSE}
library(tidyverse)
library(infer)
library(leaps)
library(MASS)
```

```{r read-data}
hotel_bookings <- read.csv("~/R/DIIG/hotel_bookings.csv")
```

First, I made some new variables and did some data cleaning:

New variable for total amount of nights stayed:
```{r total_nights}
hotel_bookings <- hotel_bookings %>%
  mutate(total_nights = stays_in_week_nights + stays_in_weekend_nights)
```

Changing the month of arrival into chronologically-ordered levels:
```{r months}
hotel_bookings <- hotel_bookings %>%
  mutate(arrival_date_month = factor(arrival_date_month, 
                                     levels = c("January", "February", "March", "April", "May",
                                                "June", "July", "August", "September",
                                                "October", "November", "December")))
```

I also changed the is_canceled variable from numeric to categorical, as 0 and 1 represent a booking being cancelled or not.
```{r is-canceled}
hotel_bookings$is_canceled <- as.factor(hotel_bookings$is_canceled)
```

I created a variable for the total number of guests during the duration of the stay:
```{r total-guests}
hotel_bookings <- hotel_bookings %>%
  mutate(total_guests = adults + children + babies)
```

I also created a new variable for the season during the arrival at the hotel, assigning the months to season.
```{r season}
hotel_bookings <- hotel_bookings %>%
  mutate(arrival_season = case_when(arrival_date_month == "December" ~ "Winter", 
                                     arrival_date_month == "January" ~ "Winter",
                                     arrival_date_month == "February" ~ "Winter",
                                     arrival_date_month == "September" ~ "Fall", 
                                     arrival_date_month == "October" ~ "Fall", 
                                     arrival_date_month == "November" ~ "Fall",
                                     arrival_date_month == "March" ~ "Spring",
                                     arrival_date_month == "April" ~ "Spring", 
                                     arrival_date_month == "May" ~ "Spring",
                                     arrival_date_month == "June" ~ "Summer", 
                                     arrival_date_month =="July" ~ "Summer", 
                                     arrival_date_month =="August" ~ "Summer"))
```


Next, I visualized the distribution of visits to the hotels based on month of the year, to find that there was an increase in volume of arrivals in the warmer months.

```{r month-distribution}
hotel_bookings %>%
  group_by(hotel, arrival_date_month) %>%
  ggplot(aes(x = arrival_date_month)) +
  geom_bar(fill = "darkblue") +
  facet_wrap(~ hotel, 
             nrow = 2, 
             scales = "free_y") +
  labs(title = "Distribution of Arrivals at Hotel by Month of the Year",
       subtitle = "Faceted by City vs. Resort Hotel",
       x = "Arrival Date Month",
       y = "Number of Arrivals")
```

Likewise, I visualized the distribution of arrivals at the hotels during the different seasons.
```{r season-distribution}
hotel_bookings %>%
  group_by(hotel, arrival_season) %>%
  ggplot(aes(x = arrival_season)) +
  geom_bar(fill = "darkblue") +
  facet_wrap(~ hotel, 
             nrow = 2, 
             scales = "free_y") +
  labs(title = "Distribution of Arrivals at Hotel by Season of the Year",
       subtitle = "Faceted by City vs. Resort Hotel",
       x = "Arrival Date Season",
       y = "Number of Arrivals")
```

Looking at average daily rate next, I visualized the distribution of average daily rate depending on the month of arrival at the hotels.
```{r meanadr, warning = FALSE}
hotel_bookings %>%
  group_by(hotel, arrival_date_month) %>%
  summarise(meanadr = mean(adr)) %>%
  ggplot(aes(x = arrival_date_month, y = meanadr)) +
  geom_col(fill = "darkblue") +
  facet_wrap(~ hotel, nrow = 2, scales = "free_y") +
  labs(title = "Mean Average Daily Rate by Hotel by Month",
       x = "Arrival Month",
       y = "Mean Average Daily Rate ($)")
```

It seems that city hotels are pretty expensive year-round, whereas resort hotels are significantly cheaper in the colder months than in the warmer months.

For this data challenge, I'll mainly be focusing on Resort Hotels, so I filtered the "City Hotels" out of my dataset. Resort Hotels piqued my interested 
```{r resort-only}
resort_bookings <- hotel_bookings %>%
  filter(hotel == "Resort Hotel")
```


Question: What influences the average daily rate at resort hotels?

I'll be looking at the number of adults, children, and babies, the arrival month, the total number of nights stayed, the meal plan, the number of special requests, and the number of purchased car parkings, because these variables are the most practical ones of the included variables when considering the price of a hotel during the booking stage. I'll build the model manually at first, and then use a stepwise backward and forward elimination to eliminate unnecessary predictors from the model. Afterwards, the model should follow the laws of Occam's Razor (the simplest model that explains the most).

```{r meanadr-month}
resort_bookings %>%
  group_by(arrival_season) %>%
  summarise(meanadr = mean(adr))
```

First, I need to figure out whether it is better to use month or season:

```{r rate-month}
m_rate_month <- lm(adr ~ arrival_date_month,
                   data = resort_bookings)

glance(m_rate_month)
```

```{r rate-season}
m_rate_season <- lm(adr ~ arrival_season,
                    data = resort_bookings)

glance(m_rate_season)
```


According to the r-squared values, arrival month explains more of the differences in average daily rate. Unfortunately, that means there will be twelve levels of that variable, rather than four levels. 

I'll also need to figure out whether I want to use total number of guests or the individual number of adults, children, and babies.

```{r rate-total-guests}
m_rate_totalguests <- lm(adr ~ total_guests, data = resort_bookings)

glance(m_rate_totalguests)
```

```{r rate-ind-guests}
m_rate_indguests <- lm(adr ~ adults + children + babies,
                       data = resort_bookings)

glance(m_rate_indguests)
```

Using the individual guests instead of the overall number of guests is better due to a slightly higher adjusted r-squared value.

Now, I'll start building the bigger model manually:

```{r m1}
m_1 <- lm(adr ~ arrival_date_month + adults,
          data = resort_bookings)

glance(m_1)
tidy(m_1)
```

Slight increase --> 0.575 in adj. r. squared with adults, without kids

```{r m2}
m_2 <- lm(adr ~ arrival_date_month + adults + children,
          data = resort_bookings)

glance(m_2)
tidy(m_2)
```

Significant increase in r-squared --> 0.629.

```{r m3}
m_3 <- lm(adr ~ arrival_date_month + adults + children + babies,
          data = resort_bookings)

glance(m_3)
tidy(m_3)
```

Very insignificant increase in r-squared with babies.

```{r m4}
m_4 <- lm(adr ~ arrival_date_month + adults + children + babies + meal,
          data = resort_bookings)

glance(m_4)
tidy(m_4)
```

Tiny increase in r-squared with meal.

```{r m5}
m_5 <- lm(adr ~ arrival_date_month + adults + children + babies + meal + total_nights,
          data = resort_bookings)

glance(m_5)
tidy(m_5)
```

Very small in r-squared with total_nights. The coefficient for total_nights is negative, indicating that holding all other factors constant, for each additional night of the stay, we expect a slightly over $1 discount in the average daily rate. This decrease in average daily rate makes sense, because usually a longer stay warrants an additional stay discount.

```{r m6}
m_6 <- lm(adr ~ arrival_date_month + adults + children + babies + meal + total_nights +
            total_of_special_requests,
          data = resort_bookings)

glance(m_6)
tidy(m_6)
```

Slightest increase in r-squared with number of special requests.

```{r m7}
m_7 <- lm(adr ~ arrival_date_month + adults + children + babies + meal + total_nights +
            total_of_special_requests + required_car_parking_spaces,
          data = resort_bookings)

glance(m_7)
tidy(m_7)
```

Also a slight tiny increase in r-squared when car parking spaces are considered.

Because no coefficient in the model changes drastically when another is added, I can assume that there is not too much multicollinearity between the predictors and move forward without too much care for interaction variables.

I'm going to do backwards and forwards (both directions) elimination with multivariate regression to see which predictors most influences average daily rate. This stepwise elimination will remove excess variables from the model.

```{r stepwise}
step.model <- stepAIC(m_7, direction = "both", 
                      trace = FALSE)
summary(step.model)
```

The model kicked out babies, but kept all other predictors. The model has an adjusted r-squared of 0.6723, which is a pretty good r-squared value, signifying that approximately 67% of the variability in average daily rate at resort hotels can be explained by the model with the above predictors.



```{r}
logit_mod2 <- glm(is_canceled ~ adults + children + babies + meal,
                  data = resort_bookings, family = "binomial", maxit = 100)

logit_mod2
```


